<!DOCTYPE>
<html>
<head></head>
<body>
	<script>
	// Create the canvas
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
canvas.width = 512;
canvas.height = 480;
document.body.appendChild(canvas);

//Background image
var bgReady = false;
var bgImage = new Image();
bgImage.onload = function() {
  bgReady = true;
};
bgImage.src = 'img/background.png';

var hero = {
  speed: 1,
  x: canvas.width / 2, //圆心的x轴坐标值
  y: canvas.height / 2, //圆心的y轴坐标值
  r: 20, //圆的半径
};

var food = {
  x: 50, //圆心的x轴坐标值
  y: 50, //圆心的y轴坐标值
  r: 5, //圆的半径
};
//边境值判断
var bound = (obj, r, wall) => {
  const obstacle = r + wall;
  obj.x = obj.x < obstacle ? obstacle : obj.x;
  obj.x = obj.x > canvas.width - obstacle ? canvas.width - obstacle : obj.x;
  obj.y = obj.y < obstacle ? obstacle : obj.y;
  obj.y = obj.y > canvas.height - obstacle ? canvas.height - obstacle : obj.y;
};
var render = () => {
  if (bgReady) {
    ctx.drawImage(bgImage, 0, 0);
  }

  //hero
  ctx.beginPath();
  ctx.fillStyle = 'yellow';
  //沿着坐标点(100,100)为圆心、半径为50px的圆的顺时针方向绘制弧
  bound(hero, hero.r, 30);
  console.log('hero ', hero);
  ctx.arc(hero.x, hero.y, hero.r, 0, Math.PI * 2, false);
  //按照指定的路径绘制弧线
  ctx.fill();
  ctx.closePath();

  //food
  ctx.beginPath();
  ctx.fillStyle = 'red';
  //沿着坐标点(100,100)为圆心、半径为50px的圆的顺时针方向绘制
  bound(food, food.r, 30);
  ctx.arc(food.x, food.y, food.r, 0, Math.PI * 2, false);
  //按照指定的路径绘制弧线
  ctx.fill();
  ctx.closePath();
};
//add key method
var keysDown = {};
addEventListener('keydown', function(e) {
  keysDown[e.keyCode] = true;
});
addEventListener('keyup', function(e) {
  delete keysDown[e.keyCode];
});
var update = function() {
  // hero position
  if (38 in keysDown) {
    // Player holding up
    hero.y -= hero.speed;
  }
  if (40 in keysDown) {
    // Player holding down
    hero.y += hero.speed;
  }
  if (37 in keysDown) {
    // Player holding left
    hero.x -= hero.speed;
  }
  if (39 in keysDown) {
    // Player holding right
    hero.x += hero.speed;
  }

  // Are they touching?
  if (
    hero.x <= food.x + 15 &&
    food.x <= hero.x + 15 &&
    hero.y <= food.y + 15 &&
    food.y <= hero.y + 15
  ) {
    // ++monstersCaught;
    reset();
  }
};
var reset = () => {
  hero.x = canvas.width / 2;
  hero.y = canvas.height / 2;

  // Throw the monster somewhere on the screen randomly
  food.x = 32 + Math.random() * (canvas.width - 64);
  food.y = 32 + Math.random() * (canvas.height - 64);
};
var main = function() {
  render();
  update();
  requestAnimationFrame(main);
};
main();
</script>
</body>
</html>
